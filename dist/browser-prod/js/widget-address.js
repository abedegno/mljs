
com=window.com||{};com.marklogic=window.com.marklogic||{};com.marklogic.widgets=window.com.marklogic.widgets||{};com.marklogic.widgets.addressbar=function(container){this.container=container;this._geo=mljs.defaultconnection.createGeoContext();this._qb=mljs.defaultconnection.createQuery();this._geocoder=new google.maps.Geocoder();this._radius=5;this._radiusMeasure="mi";this._init();};com.marklogic.widgets.addressbar.prototype.setGeoContext=function(ctx){this._geo=ctx;};com.marklogic.widgets.addressbar.prototype._init=function(){var s="Address: <input id='"+this.container+"-address' class='addressbar-address' type='text' size='20' />";s+="<input class='btn btn-primary addressbar-submit' type='submit' id='"+this.container+"-submit' value='Search' />";document.getElementById(this.container).innerHTML=s;var button=document.getElementById(this.container+"-submit");var self=this;button.onclick=function(evt){self._dosearch();evt.stopPropagation();return false;};var searchKeyPress=function(e){if(typeof e=='undefined'&&window.event){e=window.event;}
if(e.keyCode==13){button.click();}};document.getElementById(this.container+"-address").onkeypress=searchKeyPress;};com.marklogic.widgets.addressbar.prototype.radius=function(radius,radiusMeasure){this._radius=radius;this._radiusMeasure=radiusMeasure;return this;};com.marklogic.widgets.addressbar.prototype._dosearch=function(){var self=this;var address=document.getElementById(this.container+"-address").value;if(null==address||""==address){self._geo.contributeArea(self.container,null);return;}
this._geocoder.geocode({'address':address},function(results,status){console.log("Results: "+JSON.stringify(results));if(status==google.maps.GeocoderStatus.OK){var pos=results[0].geometry.location;var lat=pos.d||pos.k;var lon=pos.e||pos.A;console.log("Results: pos: "+JSON.stringify(pos)+" := lat: "+lat+", lon: "+lon);var circle=self._qb.circleDef(lat,lon,self._radius,self._radiusMeasure);self._geo.contributeArea(self.container,circle);}else{alert("Could not look up address for the following reason: "+status);}});};